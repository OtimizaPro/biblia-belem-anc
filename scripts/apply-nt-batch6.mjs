#!/usr/bin/env node
/**
 * Batch NT Translation - Lote 6
 * Aplica traduções literais para palavras gregas freq 6 no NT (parte 1: A-μ)
 */

import { execSync } from 'child_process';
import { writeFileSync, unlinkSync } from 'fs';
import { tmpdir } from 'os';
import { join } from 'path';

const DB = 'biblia-belem';
const tmpFile = join(tmpdir(), `batch6-${Date.now()}.sql`);

const translations = [
  // === Nomes próprios ===
  ["Βηθανίαν", "Betânia"],
  ["Γαλιλαίᾳ", "Galileia"],
  ["Καισαρίας", "Cesareia"],
  ["Λάζαρον", "Lázaro"],
  ["Μαριάμ", "Miriam"],
  ["Πειλάτῳ", "Pilatos"],
  ["Σαοὺλ", "Saul"],
  ["Σατανᾶς", "Satanás"],
  ["Σιλᾶν", "Silas"],
  ["Συρίαν", "Síria"],
  ["Τιμόθεον", "Timóteo"],
  ["Φῆλιξ", "Félix"],
  ["Ἀγρίππα", "Agripa"],
  ["Ἀνδρέας", "André"],
  ["Ἡσαΐου", "Isaías"],
  ["Ἰσραηλεῖται", "Israelitas"],
  ["Ἰωσήφ", "José"],
  // === Verbos ===
  ["βαπτίζων", "batizando"],
  ["βουλόμενος", "querendo"],
  ["γινώσκοντες", "conhecendo"],
  ["δέδοται", "foi-dado"],
  ["διδόναι", "dar"],
  ["διώκεις", "persegues"],
  ["εὐδόκησεν", "agradou-se"],
  ["εὑρίσκω", "encontro"],
  ["ζητοῦσιν", "buscam"],
  ["ηὔξανεν", "crescia"],
  ["θέλοντες", "querendo"],
  ["θέλουσιν", "querem"],
  ["καθήμενοι", "sentados"],
  ["καλέσας", "chamando"],
  ["καταλιπὼν", "deixando"],
  ["κατεργάζεται", "opera"],
  ["κατηγορεῖν", "acusar"],
  ["κηρύσσειν", "proclamar"],
  ["κοινοῖ", "contamina"],
  ["κρατήσας", "segurando"],
  ["κωλύετε", "impedis"],
  ["λαβοῦσα", "tomando"],
  ["μεθερμηνευόμενον", "sendo-traduzido"],
  ["πειράζοντες", "tentando"],
  ["περιπατοῦντας", "andando"],
  ["περιπατοῦσιν", "andam"],
  ["πιστεύομεν", "cremos"],
  ["πιστεύοντες", "crendo"],
  ["πλανᾶσθε", "errais"],
  ["ποιήσαντες", "tendo-feito"],
  ["πορεύομαι", "vou"],
  ["προσεύξασθαι", "orar"],
  ["προσεύχεσθαι", "orar"],
  ["σκανδαλίζει", "escandaliza"],
  ["σπείρεται", "é-semeado"],
  ["συνῆκαν", "compreenderam"],
  ["σώσει", "salvará"],
  ["τίθησιν", "põe"],
  ["φοβούμενος", "temendo"],
  ["φρονεῖν", "pensar"],
  ["φωνεῖ", "chama"],
  ["φωνῆσαι", "chamar"],
  ["ἀγνοεῖν", "ignorar"],
  ["ἁμαρτάνει", "peca"],
  ["ἀναβλέψας", "olhando-para-cima"],
  ["ἀναβὰς", "subindo"],
  ["ἀναστάντες", "levantando-se"],
  ["ἀνελεῖν", "matar"],
  ["ἀπαρνήσῃ", "negará"],
  ["ἀπεκρίνατο", "respondeu"],
  ["ἀποκτενοῦσιν", "matarão"],
  ["ἐγερθήσεται", "será-levantado"],
  ["ἐγνώκαμεν", "temos-conhecido"],
  ["ἐδικαιώθη", "foi-justificado"],
  ["ἐδοξάσθη", "foi-glorificado"],
  ["ἐδόξαζον", "glorificavam"],
  ["ἐκβάλλειν", "expulsar"],
  ["ἐλάλουν", "falavam"],
  ["ἐλέησόν", "tem-misericórdia"],
  ["ἐληλύθει", "tinha-vindo"],
  ["ἐλθόντος", "tendo-vindo"],
  ["ἐμβλέψας", "olhando-fixamente"],
  ["ἐμβὰς", "embarcando"],
  ["ἐξίσταντο", "ficavam-fora-de-si"],
  ["ἐξαπέστειλεν", "enviou-embora"],
  ["ἐπέθηκαν", "puseram-sobre"],
  ["ἐπέπεσεν", "caiu-sobre"],
  ["ἐπληρώθη", "foi-cumprido"],
  ["ἐπορεύετο", "ia"],
  ["ἐργάζεσθαι", "trabalhar"],
  ["ἐργαζόμενοι", "trabalhando"],
  ["ἐσθίειν", "comer"],
  ["ἐσθίετε", "comeis"],
  ["ἐσπλαγχνίσθη", "compadeceu-se"],
  ["ἐσχίσθη", "rasgou-se"],
  ["ἐφώνησεν", "chamou"],
  ["ἐχαρίσατο", "concedeu-graciosamente"],
  ["ἠρώτησεν", "perguntou"],
  ["ἤρχοντο", "vinham"],
  ["ἰδοῦσα", "vendo"],
  // === Substantivos ===
  ["βάθος", "profundidade"],
  ["βίον", "vida"],
  ["γάμους", "bodas"],
  ["γένος", "raça"],
  ["γράμματα", "letras"],
  ["γραφή", "escritura"],
  ["δακρύων", "lágrimas"],
  ["δεσμοῖς", "cadeias"],
  ["δεσμῶν", "prisões"],
  ["διαλέκτῳ", "dialeto"],
  ["διαφθοράν", "corrupção"],
  ["διδασκαλίας", "ensino"],
  ["δικαίους", "justos"],
  ["δικαίων", "justos"],
  ["δυνάμει", "poder"],
  ["ζιζάνια", "joio"],
  ["ζύμης", "fermento"],
  ["θελήματι", "vontade"],
  ["κάρφος", "cisco"],
  ["κήρυγμα", "pregação"],
  ["καρπῶν", "frutos"],
  ["καύχησις", "glória"],
  ["κλήσεως", "chamado"],
  ["κληρονόμος", "herdeiro"],
  ["κοιλίᾳ", "ventre"],
  ["κρίνατε", "julgai"],
  ["κύριε", "senhor"],
  ["μνείαν", "menção"],
  ["μύρου", "perfume"],
  ["νεκροὶ", "mortos"],
  ["οἰκονομίαν", "administração"],
  ["οἶκός", "casa"],
  ["παιδίου", "criança"],
  ["παραβολήν", "parábola"],
  ["παραπτώματα", "transgressões"],
  ["παρουσία", "presença"],
  ["παρουσίας", "presença"],
  ["πατρός", "pai"],
  ["πλάνης", "engano"],
  ["πονηρόν", "mau"],
  ["πονηρῶν", "maus"],
  ["προσευχῆς", "oração"],
  ["πτωχοὺς", "pobres"],
  ["σκοτία", "trevas"],
  ["στοιχεῖα", "elementos"],
  ["συκῆν", "figueira"],
  ["συμβούλιον", "conselho"],
  ["τυφλοί", "cegos"],
  ["φιλήματι", "beijo"],
  ["φυλακήν", "prisão"],
  ["φωτὶ", "luz"],
  ["χαρίσματα", "dons"],
  ["χαρᾷ", "alegria"],
  ["χιτῶνας", "túnicas"],
  ["χοίρων", "porcos"],
  ["χρόνος", "tempo"],
  ["χρόνων", "tempos"],
  ["ψεύστης", "mentiroso"],
  ["ἀγέλη", "manada"],
  ["ἀγοραῖς", "praças"],
  ["ἀζύμων", "ázimos"],
  ["ἀκάνθας", "espinhos"],
  ["ἀκροβυστίᾳ", "incircuncisão"],
  ["ἀλέκτωρ", "galo"],
  ["ἀνάγκην", "necessidade"],
  ["ἀνέμου", "vento"],
  ["ἀνομίαν", "iniquidade"],
  ["ἀποκαλύψει", "revelação"],
  ["ἀπολύτρωσιν", "redenção"],
  ["ἀποστόλοις", "apóstolos"],
  ["ἀσκοὺς", "odres"],
  ["ἀφορμὴν", "ocasião"],
  ["ἅλας", "sal"],
  ["ἐκδίκησιν", "vingança"],
  ["ἐμαυτόν", "a-mim-mesmo"],
  ["ἐναντίον", "diante-de"],
  ["ἐνιαυτὸν", "ano"],
  ["ἐπαγγελία", "promessa"],
  ["ἐργάτας", "trabalhadores"],
  ["ἐχθρούς", "inimigos"],
  ["ἐχθροὺς", "inimigos"],
  ["ἑορτήν", "festa"],
  ["ἔθος", "costume"],
  ["ὀργὴν", "ira"],
  ["ὀφθαλμοῦ", "olho"],
  ["ὁδοὺς", "caminhos"],
  ["ὁρίων", "fronteiras"],
  ["ὄναρ", "sonho"],
  // === Adjetivos / Pronomes / Partículas ===
  ["Διδάσκαλος", "Mestre"],
  ["Καλῶς", "Bem"],
  ["Λάβετε", "Tomai"],
  ["Οὐχὶ", "Não"],
  ["Προσέχετε", "Guardai-vos"],
  ["Τίνι", "A-quem"],
  ["Υἱὲ", "Filho"],
  ["Ἄφες", "Deixa"],
  ["Ἀληθῶς", "Verdadeiramente"],
  ["Ἐπιστάτα", "Mestre"],
  ["Ἔξελθε", "Sai"],
  ["Ἔτι", "Ainda"],
  ["Ἕλληνας", "Gregos"],
  ["αὐταῖς", "a-elas"],
  ["αὐτός", "ele-mesmo"],
  ["γενεᾷ", "geração"],
  ["γενόμενα", "tendo-acontecido"],
  ["γενόμενοι", "tendo-se-tornado"],
  ["γνῶτε", "conheçais"],
  ["δεδεμένον", "amarrado"],
  ["δυνατὸν", "possível"],
  ["δῷ", "dê"],
  ["εἰκῇ", "em-vão"],
  ["εἰπὲ", "dize"],
  ["εἴπερ", "se-de-fato"],
  ["εἴπωσιν", "digam"],
  ["ζῶντα", "vivendo"],
  ["καθότι", "assim-como"],
  ["κἀκεῖνος", "e-aquele"],
  ["κενὸν", "vazio"],
  ["κεῖται", "está-posto"],
  ["κοινὸν", "comum"],
  ["μέλλειν", "estar-prestes"],
  ["μέλλοντα", "as-coisas-futuras"],
  ["μέλλοντος", "do-que-está-por-vir"],
  ["μένετε", "permanecei"],
  ["μέσον", "meio"],
  ["μέτρον", "medida"],
  ["μείνῃ", "permaneça"],
  ["μητρὶ", "mãe"],
  ["οὐδενὸς", "de-ninguém"],
  ["οὖσαν", "sendo"],
  ["πάλαι", "outrora"],
  ["πάντως", "de-todo-modo"],
  ["πέμψαντά", "o-que-enviou"],
  ["πέμψω", "enviarei"],
  ["πίω", "beba"],
  ["παρέλθῃ", "passe"],
  ["παρήγγειλεν", "ordenou"],
  ["παραδιδοὺς", "entregando"],
  ["παρακαλέσαι", "consolar"],
  ["παρεκάλεσαν", "suplicaram"],
  ["παρελάβετε", "recebestes"],
  ["παρὼν", "estando-presente"],
  ["πεντήκοντα", "cinquenta"],
  ["πλείονας", "mais"],
  ["πολλούς", "muitos"],
  ["πολλοῖς", "muitos"],
  ["πώποτε", "jamais"],
  ["τοιαύτην", "tal"],
  ["τοιούτων", "de-tais"],
  ["τοιοῦτοι", "tais"],
  ["τοιοῦτον", "tal"],
  ["τρίτον", "terceira-vez"],
  ["φάγωσιν", "comam"],
  ["χαίροντες", "alegrando-se"],
  ["ἀγαθὰ", "boas-coisas"],
  ["ἀγαθῶν", "boas-coisas"],
  ["ἀγαπητόν", "amado"],
  ["ἀξίως", "dignamente"],
  ["ἀρθήσεται", "será-tirado"],
  ["ἀρχιερεῦσιν", "sumos-sacerdotes"],
  ["ἀσθενεῖς", "fracos"],
  ["ἀσθενῶν", "fracos"],
  ["ἄλλοις", "a-outros"],
  ["ἄλλον", "outro"],
  ["ἄξιος", "digno"],
  ["ἆραι", "levantar"],
  ["ἆρον", "levanta"],
  ["ἑαυτῆς", "de-si-mesma"],
  ["ἑκάστῳ", "a-cada-um"],
  ["ἑτέρα", "outra"],
  ["ἑτέρου", "de-outro"],
  ["ἔγνων", "conheci"],
  ["ἔκλασεν", "partiu"],
  ["ἔλθω", "venha"],
  ["ἔνι", "há"],
  ["ἔνοχος", "culpado"],
  ["ἔχωμεν", "tenhamos"],
  ["ἕξει", "terá"],
  ["ἕτεροι", "outros"],
  ["ἐξαυτῆς", "imediatamente"],
  ["ἐμὰ", "minhas-coisas"],
  ["ἐμὸς", "meu"],
  ["ἐμῇ", "minha"],
  ["ἦμεν", "éramos"],
  ["ἰδίας", "próprias"],
  ["ἰσχύος", "força"],
  ["ἱερόν", "templo"],
  ["ἱκανὸν", "suficiente"],
  ["ὀφείλομεν", "devemos"],
];

let success = 0;
let errors = 0;
let totalUpdated = 0;

console.log(`\n=== Tradução NT - Lote 6 (freq 6, parte 1) ===`);
console.log(`Palavras a traduzir: ${translations.length}`);
console.log(`Início: ${new Date().toLocaleString('pt-BR')}\n`);

for (const [word, translation] of translations) {
  try {
    const escapedWord = word.replace(/'/g, "''");
    const escapedTranslation = translation.replace(/'/g, "''");

    const sql = `UPDATE tokens SET pt_literal = '${escapedTranslation}' WHERE text_utf8 = '${escapedWord}' AND pt_literal LIKE '[%]';`;

    writeFileSync(tmpFile, sql, 'utf-8');
    const result = execSync(
      `npx wrangler d1 execute ${DB} --remote --file "${tmpFile}" --json`,
      { encoding: 'utf-8', timeout: 30000 }
    );

    // Strip non-JSON output (--file adds progress indicators)
    const jsonStart = result.indexOf('[');
    const jsonStr = result.substring(jsonStart);
    const parsed = JSON.parse(jsonStr);
    const changes = parsed[0]?.meta?.changes || 0;
    totalUpdated += changes;

    if (changes > 0) {
      process.stdout.write(`✓ ${word} → ${translation} (${changes})\n`);
    } else {
      process.stdout.write(`· ${word} → ${translation} (0)\n`);
    }
    success++;
  } catch (err) {
    process.stdout.write(`✗ ${word} → ${translation} (ERRO)\n`);
    errors++;
  }
}

try { unlinkSync(tmpFile); } catch {}

console.log(`\n=== Resultado Lote 6 ===`);
console.log(`Sucesso: ${success}/${translations.length}`);
console.log(`Erros: ${errors}`);
console.log(`Tokens atualizados: ${totalUpdated}`);
console.log(`Fim: ${new Date().toLocaleString('pt-BR')}\n`);
